<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Loan Application Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="card shadow-lg">
            <div class="card-header bg-primary text-white text-center">
                <h2>Loan Application Form</h2>
            </div>
            <div class="card-body">
                <form id="loanForm">
                    <div class="row mb-3">
                        <div class="col">
                            <label class="form-label">Married</label>
                            <select class="form-select" name="Married" required>
                                <option value="">Select</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div class="col">
                            <label class="form-label">Education</label>
                            <select class="form-select" name="Education" required>
                                <option value="">Select</option>
                                <option value="Graduate">Graduate</option>
                                <option value="Not Graduate">Not Graduate</option>
                            </select>
                        </div>
                        <div class="col">
                            <label class="form-label">Self Employed</label>
                            <select class="form-select" name="Self_Employed" required>
                                <option value="">Select</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col">
                            <label class="form-label">Applicant Income</label>
                            <input type="number" class="form-control" name="ApplicantIncome" required>
                        </div>
                        <div class="col">
                            <label class="form-label">Coapplicant Income</label>
                            <input type="number" class="form-control" name="CoapplicantIncome">
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col">
                            <label class="form-label">Loan Amount</label>
                            <input type="number" class="form-control" name="LoanAmount" required>
                        </div>
                        <div class="col">
                            <label class="form-label">Loan Amount Term (months)</label>
                            <input type="number" class="form-control" name="Loan_Amount_Term" required>
                        </div>
                        <div class="col">
                            <label class="form-label">Credit History</label>
                            <input type="number" class="form-control" name="Credit_History" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Property Area</label>
                        <select class="form-select" name="Property_Area" required>
                            <option value="">Select</option>
                            <option value="Urban">Urban</option>
                            <option value="Semiurban">Semiurban</option>
                            <option value="Rural">Rural</option>
                        </select>
                    </div>

                    <div class="text-center">
                        <button type="submit" class="btn btn-success btn-lg">Submit Application</button>
                    </div>
                </form>

                <!-- Result display -->
                <div id="result" class="mt-4 text-center"></div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById("loanForm").addEventListener("submit", async function(event) {
            event.preventDefault();

            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());

            // Convert numeric fields to numbers
            data.ApplicantIncome = parseFloat(data.ApplicantIncome);
            data.CoapplicantIncome = parseFloat(data.CoapplicantIncome || 0);
            data.LoanAmount = parseFloat(data.LoanAmount);
            data.Loan_Amount_Term = parseFloat(data.Loan_Amount_Term);
            data.Credit_History = parseFloat(data.Credit_History);

            try {
                const response = await fetch("/predict", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                document.getElementById("result").innerHTML =
                    result.predicted_output === 1
                        ? "<h3 class='text-success'>✅ Loan Approved</h3>"
                        : "<h3 class='text-danger'>❌ Loan Rejected</h3>";
            } catch (error) {
                document.getElementById("result").innerHTML =
                    "<h3 class='text-warning'>⚠️ Error submitting application</h3>";
            }
        });
    </script>
</body>
</html>